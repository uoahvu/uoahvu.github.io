---
layout: single
title: "PAIR-WISE ê¸°ë°˜ ì·¨í–¥ ë­í‚¹ í•™ìŠµìœ¼ë¡œ ë¬´í•œë„ì „ ì½˜í…ì¸  ì¶”ì²œí•˜ê¸°"
excerpt: "[Crawling Dataset] ì½˜í…ì¸  ê¸°ë°˜ ì„ë² ë”© Retrieval ê³¼ Pair-wise Ranking Modelì„ ê²°í•©í•œ ë™ì˜ìƒ ì¶”ì²œ ì‹œìŠ¤í…œ"
last_modified_at: 2024-12-08
toc: true
comments: true
categories: Recommendation
use_math: true
---

ğŸ¯ ìœ ì €ì˜ ì´ë ¥ ë°ì´í„°ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°, ê°„ë‹¨í•œ ì„ í˜¸ ì¡°ì‚¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‘ë™í•˜ëŠ” ì¶”ì²œì‹œìŠ¤í…œì„ êµ¬í˜„í•œë‹¤. í˜„ì¬ ì‹œì²­ì¤‘ì¸ ê²ƒê³¼ ìœ ì‚¬ë„ê°€ ë†’ì€ ìˆœì„œëŒ€ë¡œ ì½˜í…ì¸ ë¥¼ ì¶”ì²œí•˜ë˜ ê° ì½˜í…ì¸ ë¥¼ í‘œí˜„í•˜ëŠ” ë²¡í„°ëŠ” ìœ ì € ì„ í˜¸ë„ì— ë”°ë¼ ì¬í•™ìŠµëœ ê²ƒì´ë‹¤.

# ğŸ–±ï¸ Data Crawling

ë¬´í•œë„ì „ ì½˜í…ì¸ ë¥¼ ì›¹í¬ë¡¤ë§ìœ¼ë¡œ ì§ì ‘ ìˆ˜ì§‘í•˜ì—¬ ì‚¬ìš©í–ˆìœ¼ë©°, ë™ì˜ìƒ ì‹œì²­ ì´ë ¥ì€ ë”°ë¡œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.

[MBC ë¬´í•œë„ì „ ë‹¤ì‹œë³´ê¸° ë™ì˜ìƒ](https://playvod.imbc.com/templete/VodList?bid=1000786100000100000)


> ![image](https://github.com/user-attachments/assets/17e4eacb-61ea-4ef9-be36-acabacf88cdc)
ê·¸ë¦¼ 1. ë¬´í•œë„ì „ ë‹¤ì‹œë³´ê¸°
> ![image](https://github.com/user-attachments/assets/8ff2d1cb-1055-4fad-b7f2-00d5326bce0d)
ê·¸ë¦¼ 2. ë¬´í•œë„ì „ ë‹¤ì‹œë³´ê¸° - íšŒì°¨ë³„ ì„¤ëª…

ì´ 589ê°œ íšŒì°¨ì˜ ì œëª©ê³¼ ë°©ì˜ì¼ì, ì˜ìƒê¸¸ì´ ë“± ê¸°ë³¸ ë©”íƒ€ì •ë³´ë¥¼ ìˆ˜ì§‘í–ˆê³ , ê° íšŒì°¨ ì¸ë„¤ì¼ í´ë¦­ ì‹œ í™•ì¸ê°€ëŠ¥í•œ ì„¤ëª… í…ìŠ¤íŠ¸(ê·¸ë¦¼2)ë¥¼ ì¶”ê°€ë¡œ ìˆ˜ì§‘í–ˆë‹¤.



# ğŸ” Content-based Embedding Model (Retrieval)

>![image](https://github.com/user-attachments/assets/528b2a32-1eb9-42fb-b528-5371e2108788)
ê·¸ë¦¼ 3. ë¬´í•œë„ì „ ì½˜í…ì¸  íšŒì°¨ë³„ ì •ë³´ ë°ì´í„°ì…‹



## ğŸ§‘â€ğŸ’» Data Preprocessing

ìœ ì‚¬ë„ ê¸°ë°˜ ê²€ìƒ‰ì„ ìœ„í•´ ê° íšŒì°¨ë³„ ì½˜í…ì¸ ë¥¼ ìµœì ì˜ ì„ë² ë”© ë²¡í„°ë¡œ í‘œí˜„í•˜ê¸° ìœ„í•œ ë°ì´í„° ì „ì²˜ë¦¬ ê³¼ì •ì„ ê±°ì³¤ë‹¤.  

### ğŸ§ Feature 1 ) ë¬´í•œë„ì „ ì‹œì¦Œ

ë¬´í•œë„ì „ì€ ì•½ 13ë…„ê°„ ë°©ì˜í•œ í”„ë¡œê·¸ë¨ìœ¼ë¡œ, ê¸°ê°„ ë‚´ í¬ê³ ì‘ì€ ë©¤ë²„ êµ¬ì„± ë³€í™”ê°€ ì¦ì•˜ë‹¤. ë©¤ë²„ì˜ êµ¬ì„±ì— ë”°ë¼ íšŒì°¨ë³„ ì„ í˜¸ë„ê°€ ë‹¬ë¼ì§„ë‹¤ëŠ” ì ì„ ë°˜ì˜í•˜ê¸° ìœ„í•´ ë°©ì˜ì¼ìë³„ ì‹œì¦Œì„ ë‚˜ëˆ„ì–´ ì½˜í…ì¸  ë²¡í„°ì— ë°˜ì˜í–ˆë‹¤.

```python
# ë°©ì˜ì¼ì => ì‹œì¦Œ
def date2season(x):
    periods = [
        ("2006-05-06", "2008-03-08", 1),  # 2006.05.06 ~ 2008.03.08
        ("2008-03-15", "2009-05-30", 2),  # 2008.03.15 ~ 2009.05.30 +ì „ì§„ -í•˜í•˜
        ("2009-06-06", "2010-03-20", 3),  # 2009.06.06 ~ 2010.03.20 +ê¸¸ -ì „ì§„
        ("2010-03-27", "2012-01-31", 4),  # 2010.03.27 ~ 2012.01 +í•˜í•˜ (7ì¸)
        # ("2012-02-01", "2012-07-14", 5),  # 2012.02 ~ 2012.07.14 íŒŒì—…
        ("2012-07-14", "2014-05-03", 5),  # 2012.07.14 ~ 2014.05.03 (7ì¸)
        ("2014-05-03", "2014-11-15", 6),  # 2014.05.03 ~ 2014.11.08 -ê¸¸
        ("2014-11-17", "2015-05-09", 7),  # 2014.11.17 ~ 2015.05.09 -í™ì² 
        ("2015-05-09", "2015-11-12", 8),  # 2015.05.09 ~ 2015.11.12 +ê´‘í¬
        ("2015-11-12", "2016-04-09", 9),  # 2015.11.12 ~ 2016.04.09 -í˜•ëˆ
        ("2016-04-09", "2017-03-25", 10),  # 2016.04.09 ~ 2017.03.25 +ì„¸í˜•
        ("2017-03-25", "2017-09-08", 11),  # 2017.03.25 ~ 2017.09.08 -ê´‘í¬
        ("2017-09-08", "2017-11-18", 12),  # 2017.09.08 ~ 2017.11.18 íŒŒì—…
        ("2017-11-25", "2018-03-31", 13),  # 2017.11.25 ~ 2018.03.31 +ì„¸í˜¸
    ]
    for start_date, end_date, season in periods:
        if x <= end_date and x >= start_date:
            return season
    return 0
```

ë©¤ë²„ êµ¬ì„±ì„ ê¸°ì¤€ìœ¼ë¡œ ì‹œì¦Œì„ ì •ì˜í–ˆìœ¼ë©°, í•„ìëŠ” ê°œì¸ì ìœ¼ë¡œ 7ì¸ì²´ì œë¥¼ ì¢‹ì•„í•œë‹¤.


### ğŸ‘€ Feature 2 ) íŠ¹ì§‘íšŒ ì—¬ë¶€

>![image](https://github.com/user-attachments/assets/e3b1e0a0-80aa-4a72-9ae2-7155d2ba1a27)
ê·¸ë¦¼ 4. íŠ¹ì§‘íšŒ

ê°„í˜¹ ì •ê·œë°©ì˜ë¶„ì´ ì•„ë‹Œ ì´ë¯¸ ë°©ì˜í–ˆë˜ ê²ƒì„ ì¬êµ¬ì„±í•˜ì—¬ ë‚´ë³´ë‚´ëŠ” ë“±ì˜ íŠ¹ì§‘íšŒê°€ ì¡´ì¬í–ˆë‹¤. ì´ë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•´ íŠ¹ì§‘íšŒë¼ë©´ `1` ì•„ë‹ˆë¼ë©´ `0`ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ì „ì²˜ë¦¬í–ˆë‹¤.

```python
df["special"] = df["vod_num"].apply(lambda x: 1 if x == "íŠ¹ì§‘íšŒ" else 0)
```


### ğŸï¸ Feature 3 ) ëŸ°íƒ€ì„

```python
def timestr2min(x):
    splited_time = x.split(":")
    return (
        float(splited_time[2]) / 60.0
        + float(splited_time[1])
        + float(splited_time[0]) * 60.0
    )
```

ê° íšŒì°¨ì˜ ì˜ìƒ ê¸¸ì´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ”ë°, `01:19:57` ì™€ ê°™ì€ í˜•íƒœë¡œ ìˆ˜ì§‘ëœë‹¤. ì´ë¥¼ ë¶„ ë‹¨ìœ„ì˜ ì‹¤ìˆ˜(float) íƒ€ì…ìœ¼ë¡œ ì „ì²˜ë¦¬ í•´ì£¼ì—ˆë‹¤.

`01:19:57` ì—ì„œ 'ì´ˆ' ëŠ” 60ìœ¼ë¡œ ë‚˜ëˆ„ê³ , 'ë¶„'ì€ ê·¸ëŒ€ë¡œ, 'ì‹œ'ì—ëŠ” 60ì„ ê³±í•´ ë”í•´ì¤€ë‹¤. ì¦‰, 0.95 + 19 + 60 = `79.95` ë¡œ í‘œí˜„ëœë‹¤. 



### ğŸª„ Feature 4 ) ì œëª© ë° ì„¤ëª…



```python
# Description
df["description"] = df["description"].str.replace(
    r"[^a-zA-Zê°€-í£0-9 ]", "", regex=True
)

df["title_"] = df["title"].str.replace(r"[ë¬´í•œë„ì „]", "")
```


ê° íšŒì°¨ì˜ íŠ¹ì§•ì„ í‘œí˜„í•˜ëŠ” ë° ê°€ì¥ ì¤‘ìš”í•œ ë‹¨ì„œë¥¼ ì œê³µí•˜ëŠ” ê²ƒì€ í…ìŠ¤íŠ¸ë¼ê³  ìƒê°í•œë‹¤. 
ì œëª© í…ìŠ¤íŠ¸ì—ì„œ ê³µí†µì ìœ¼ë¡œ ë“±ì¥í•˜ëŠ” `"ë¬´í•œë„ì „"` ì€ ì‚­ì œí•˜ê³ , ì„¤ëª…í…ìŠ¤íŠ¸ëŠ” íŠ¹ìˆ˜ë¬¸ì ë“±ì„ ì œì™¸í•œ í•œê¸€&ì˜ì–´&ìˆ«ì ë¡œë§Œ êµ¬ì„±ë˜ë„ë¡ ì „ì²˜ë¦¬í•œë‹¤.


## ğŸ“– Embedding Model

>![image](https://github.com/user-attachments/assets/7b72fe8a-7802-4ac9-90f4-62aaa23e34ee)
ê·¸ë¦¼ 5. íšŒì°¨ë³„ ì„ë² ë”© ë²¡í„° êµ¬ì„±ë„

ì „ì²˜ë¦¬ëœ ë°ì´í„°ëŠ” ì„ë² ë”© ë²¡í„°ë¡œ í‘œí˜„ëœë‹¤. ì‹œì¦Œ, íŠ¹ì§‘íšŒ ì—¬ë¶€, ì œëª© ë° ì„¤ëª… í…ìŠ¤íŠ¸ê°€ Featureë¡œ ì‚¬ìš©ë˜ë©° ê·¸ë¦¼ 5ì™€ ê°™ì€ ì„ë² ë”© ê³¼ì •ì„ ê±°ì¹œë‹¤.
ì‹œì¦Œì€ ê¸¸ì´ê°€ 64ì¸ ì„ë² ë”© ë²¡í„°ë¡œ í‘œí˜„í•˜ì—¬ ê° ì‹œì¦Œì˜ íŠ¹ì§•ì´ í•™ìŠµë  ìˆ˜ ìˆë„ë¡ í•œë‹¤. íŠ¹ì§‘ ì—¬ë¶€ëŠ” 1ê³¼ 0ìœ¼ë¡œ í‘œí˜„ë˜ì—ˆìœ¼ë©°, One-Hot ì¸ì½”ë”©í•˜ì—¬ í‘œí˜„í•œë‹¤.


### Sentence Transformer ê¸°ë°˜ ì‚¬ì „ í•™ìŠµ í…ìŠ¤íŠ¸ ì„ë² ë”© ëª¨ë¸

```python
from sentence_transformers import SentenceTransformer

class ContentEmbedding(nn.Module):
    def __init__(self, hidden_size, num_season):
        super(ContentEmbedding, self).__init__()
        ...
        self.description_embedding = SentenceTransformer(
            "sentence-transformers/all-MiniLM-L6-v2"
        )
    def forward(self, x):
        ...
        # ì œëª©í…ìŠ¤íŠ¸
        embedded_title = torch.tensor(
            self.description_embedding.encode(x.loc[:, "title_"])
        )
        # ì„¤ëª…í…ìŠ¤íŠ¸
        embedded_description = torch.tensor(
            self.description_embedding.encode(x.loc[:, "description"])
        )
        ...
```

ìœ„ ì½”ë“œëŠ” ì½˜í…ì¸  ì„ë² ë”© ëª¨ë¸ì˜ ì¼ë¶€ì´ë‹¤. ì œëª© ë° ì„¤ëª… í…ìŠ¤íŠ¸ë¥¼ ì„ë² ë”©í•˜ê¸° ìœ„í•´ sentence_transformers íŒ¨í‚¤ì§€ì˜ SentenceTransformer ëª¨ë¸ì„ ì‚¬ìš©í•œë‹¤.
ê·¸ ì¤‘ [all-MiniLM-L6-v2](https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2) ì€ ë‹¤êµ­ì–´ ë°ì´í„°ì…‹ìœ¼ë¡œ ì‚¬ì „í•™ìŠµëœ ëª¨ë¸ë¡œ, ë¬¸ì¥ì— ëŒ€í•œ 384 ì°¨ì›ì˜ ì„ë² ë”© ë²¡í„°ë¥¼ ë„ì¶œí•  ìˆ˜ ìˆë‹¤.


## FAISS(Vector Store)


# Pair-Wise Ranking Model

## Triplet Margin Loss


# Recommendation Flow



# ğŸ§‘â€ğŸ’» Code

[ğŸ—‚ï¸ Github - Recommender system for Korean variety show "Infinite Challenge"](https://github.com/uoahvu/infinite-challenge-contents-recommendation)