---
layout: single
title: "ì†Œë¹„ìê°€ êµ¬ë§¤í•  ê°€ëŠ¥ì„±ì´ ë†’ì€ Top K ìƒí’ˆ ì¶”ì²œëª¨ë¸ë§ (Session-based Recommendation)"
excerpt: "êµ¬ë§¤ì´ë ¥ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìœ ì €ê°€ êµ¬ë§¤í• ë§Œí•œ ìƒí’ˆì„ ì œê³µí•˜ëŠ” ì¶”ì²œì‹œìŠ¤í…œ"
last_modified_at: 2024-11-20
comments: true
categories: Recommendation
---

# Data Processing

## Retailrocket recommender system dataset

êµ¬ë§¤ì´ë ¥ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìœ ì €ê°€ êµ¬ë§¤í• ë§Œí•œ ìƒí’ˆì„ ì œê³µí•˜ëŠ” ì¶”ì²œì‹œìŠ¤í…œì„ êµ¬í˜„í•œë‹¤.

[ğŸ—‚ï¸ Kaggle : Retailrocket recommender system dataset](https://www.kaggle.com/datasets/retailrocket/ecommerce-dataset)

Kaggleì˜ retailrocket ìƒí’ˆì†Œë¹„ì´ë ¥ ë°ì´í„°ì…‹ì„ ì‚¬ìš©í•˜ë©°, í•´ë‹¹ ë°ì´í„°ì…‹ì€ ì „ììƒê±°ë˜ ì›¹ì‚¬ì´íŠ¸ì— ë°©ë¬¸í•œ ìœ ì €ì˜ í–‰ë™ ë°ì´í„°(events.csv), ìƒí’ˆì˜ ì†ì„± ë°ì´í„°(item_properties.csv), ì¹´í…Œê³ ë¦¬ íŠ¸ë¦¬ ë°ì´í„°(category_tree.csv)ë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤.

í•„ìëŠ” ì˜¤ì§ í–‰ë™ ë°ì´í„°ì˜ ìœ ì € í–‰ë™ 3ê°€ì§€(view, addtocart, transaction(êµ¬ë§¤))ë¥¼ ë°”íƒ•ìœ¼ë¡œ ëª¨ë¸ë§í–ˆìœ¼ë©°, ì•„ì´í…œì˜ ì†ì„±ìœ¼ë¡œëŠ” ì•„ì´í…œì˜ ì¹´í…Œê³ ë¦¬ì™€ ë¶€ëª¨ ì¹´í…Œê³ ë¦¬ë¥¼ í¬í•¨í–ˆë‹¤. 



| idx     | timestamp           | visitorid | event   | itemid | transactionid   | session | category | parentid | 
|--------|---------------------|---------|--------------|---------|---------|------------|------------|------------|
| 194510 | 2015-09-18 00:42:47 | 152963  | view         | 302559  | NaN     | 273        | -1         | -1.0       | 
| 194511 | 2015-09-18 00:42:51 | 152963  | addtocart    | 302559  | NaN     | 273        | -1         | -1.0       | 
| 194512 | 2015-09-18 00:45:03 | 152963  | transaction  | 302559  | 2553.0  | 273        | -1         | -1.0       | 
| 194531 | 2015-09-18 02:04:16 | 152963  | view         | 380196  | NaN     | 274        | 973        | 20.0       | 
| 194532 | 2015-09-18 02:04:43 | 152963  | view         | 122984  | NaN     | 274        | 1493       | 594.0      | 
| 194533 | 2015-09-18 02:04:53 | 152963  | view         | 380196  | NaN     | 274        | 973        | 20.0       | 
| 194534 | 2015-09-18 02:05:13 | 152963  | view         | 122984  | NaN     | 274        | 1493       | 594.0      | 
| 194535 | 2015-09-18 02:05:21 | 152963  | view         | 380196  | NaN     | 274        | 973        | 20.0       | 
| 194536 | 2015-09-18 02:05:34 | 152963  | addtocart    | 380196  | NaN     | 274        | 973        | 20.0       | 
| 194537 | 2015-09-18 02:08:16 | 152963  | transaction  | 72462   | 5772.0  | 274        | 1493       | 594.0      |
| 194538 | 2015-09-18 02:08:16 | 152963  | transaction  | 12504   | 5772.0  | 274        | 1493       | 594.0      | 
| 194539 | 2015-09-18 02:08:16 | 152963  | transaction  | 380196  | 5772.0  | 274        | 973        | 20.0       | 
| 194540 | 2015-09-18 02:08:16 | 152963  | transaction  | 122984  | 5772.0  | 274        | 1493       | 594.0      | 
| 194541 | 2015-09-18 02:08:16 | 152963  | transaction  | 334401  | 5772.0  | 274        | 1043       | 226.0      |
| 194542 | 2015-09-18 02:12:38 | 152963  | view         | 342659  | NaN     | 275        | 1177       | 381.0      | 
| 194543 | 2015-09-18 02:34:21 | 152963  | view         | 366177  | NaN     | 275        | 808        | 1272.0     | 
| 194544 | 2015-09-18 02:35:07 | 152963  | view         | 362697  | NaN     | 275        | 1663       | 1398.0     | 
| 194545 | 2015-09-18 02:36:34 | 152963  | addtocart    | 362697  | NaN     | 275        | 1663       | 1398.0     | 
| 194546 | 2015-09-18 02:38:18 | 152963  | transaction  | 362697  | 5670.0  | 275        | 1663       | 1398.0     | 


ìœ„ ë°ì´í„°í”„ë ˆì„ì€ ìœ ì €ê°€ íŠ¹ì • ìƒí’ˆì„ ë³´ê±°ë‚˜(view), ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ê±°ë‚˜(addtocart), êµ¬ë§¤í•œ(transaction) í–‰ë™ë°ì´í„°ë¥¼ ì‹œê°„(timestamp) ìˆœìœ¼ë¡œ ì •ë ¬í•œ ë°ì´í„°ì´ë‹¤. ìƒí’ˆ(itemid)ì´ ì–´ë–¤ ì¹´í…Œê³ ë¦¬ì™€ ë¶€ëª¨ì¹´í…Œê³ ë¦¬ì— ì†í•´ìˆëŠ” ì§€ë¥¼ í¬í•¨í•˜ë„ë¡ ê°€ê³µí–ˆë‹¤. 

* ìœ ì €(visitorid) 152963 ì€ session 273 ì—ì„œ ìƒí’ˆ 302559ì„ êµ¬ë§¤í•˜ê³ , ìƒˆë¡œìš´ sessoin 274 ë²ˆì—ì„œ ìƒí’ˆ 380196 ì„ ë‘˜ëŸ¬ë³´ë©° ì‹œì‘í•œë‹¤. 

<br/>

---


>![image](https://github.com/user-attachments/assets/776f0b48-81a8-414a-a8a8-03007b2e3fe4)
ê·¸ë¦¼ 1. How to define a session in this project


í•„ìëŠ” í•˜ë‚˜ì˜ ì„¸ì…˜ì„ "**êµ¬ë§¤ë¥¼ ì™„ë£Œí•  ë•Œë§ˆë‹¤**" ë¡œ ì •ì˜í–ˆë‹¤. ìƒí’ˆ êµ¬ë§¤ë¥¼ ì™„ë£Œí•˜ë©´ ì†Œë¹„ìëŠ” êµ¬ë§¤í•œ ìƒí’ˆê³¼ëŠ” ë¨¼, ë˜ ë‹¤ë¥¸ í•„ìš”ì— ì˜í•´ ìƒí’ˆì„ íƒìƒ‰í•  ê²ƒì´ë¼ëŠ” ì „ì œì´ë‹¤. ê·¸ë¦¼ 1ì€ ê° ì„¸ì…˜ì„ í‘œí˜„í•œ ê²ƒìœ¼ë¡œ, ê° í–‰ë™ì„ ë‚˜íƒ€ë‚´ëŠ” ì§ì‚¬ê°í˜•ì˜ ê°€ë¡œ í­ì€ ìƒí’ˆì˜ ê°œìˆ˜ì™€ ë¹„ë¡€í•œë‹¤. 

ì¦‰ ì²«ë²ˆì§¸ ì„¸ì…˜ì˜ ê²½ìš° ìœ ì €ëŠ” ì—¬ëŸ¬ ìƒí’ˆì„ ë³´ë‹¤ê°€ ì¥ë°”êµ¬ë‹ˆì— ìƒí’ˆì„ ë‹´ê³  ê³§ë°”ë¡œ êµ¬ë§¤ë¡œ ì´ì–´ì¡Œë‹¤. ë‘ë²ˆì§¸ ì„¸ì…˜ì˜ ê²½ìš° ìƒí’ˆì„ ë‘˜ëŸ¬ë³´ëŠ” ì¤‘ê°„ì— ì¥ë°”êµ¬ë‹ˆì— ìƒí’ˆì„ ë‹´ì•˜ê³ , ë§ˆì§€ë§‰ì— ë§ˆìŒì— ë“œëŠ” ìƒí’ˆë§Œ êµ¬ë§¤í–ˆë‹¤. ë§ˆì§€ë§‰ ì„¸ì…˜ì˜ ê²½ìš° ë”°ë¡œ ì¥ë°”êµ¬ë‹ˆì— ë‹´ì§€ ì•Šê³  ì—°ì´ì–´ ìƒí’ˆì„ êµ¬ë§¤í–ˆë‹¤. 


>![image](https://github.com/user-attachments/assets/84069994-9c0e-4f60-a741-6ed9928c25b4)
ê·¸ë¦¼ 2. How to define inputs and outputs in a session

ê° ì„¸ì…˜ ë‚´ì—ì„œ íƒ€ê²Ÿ(Y) ìƒí’ˆì€ ìœ ì €ê°€ ì›í•˜ëŠ” ìƒí’ˆ, êµ¬ë§¤í•  ê°€ëŠ¥ì„±ì´ ë†’ì€ ìƒí’ˆì´ì–´ì•¼ í•˜ë¯€ë¡œ, ì¥ë°”êµ¬ë‹ˆì— ë‹´ì€ ìƒí’ˆ(addtocart)ê³¼ êµ¬ë§¤í•œ ìƒí’ˆ(transaction)ì„ ëŒ€ìƒìœ¼ë¡œ ì§„í–‰í•œë‹¤. ê·¸ ì™¸ ìœ ì €ê°€ ë³¸ ìƒí’ˆ(view) ì„ inputìœ¼ë¡œ í•˜ì—¬ Yë¥¼ ì˜ˆì¸¡í–ˆë‹¤. ì¦‰ **ìœ ì €ê°€ ë³¸ ìƒí’ˆê³¼ ê·¸ ìƒí’ˆì˜ ì¹´í…Œê³ ë¦¬ë“¤ì˜ ì‹œí€€ìŠ¤ë¥¼ ë³´ê³ , êµ¬ë§¤í•  ê°€ëŠ¥ì„±ì´ ë†’ì€ ìƒí’ˆ nê°œë¥¼ ì¶”ì¶œ**í•˜ëŠ” ê²ƒì´ë‹¤. 


> ğŸ§ <br/>
> ìœ ì €ëŠ” ìƒí’ˆì„ ë³¸ í›„ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê±°ë‚˜ êµ¬ë§¤í•œë‹¤. ì¦‰ X ì•ˆì— Y ê°€ í¬í•¨ë  ìˆ˜ ìˆë‹¤. ì´ê²ƒì„ ë¬¸ì œ ì‚¼ì§€ ì•Šì€ ì´ìœ ëŠ” ìœ ì €ê°€ ë³´ê³  ì§€ë‚˜ê°„ ìƒí’ˆì´ë”ë¼ë„ í•œë²ˆ ë” í™”ë©´ì— ë…¸ì¶œì‹œí‚¤ê±°ë‚˜ ì•Œë¦¼ì„ ë³´ë‚´ êµ¬ë§¤ë¥¼ ìœ ë„í•˜ëŠ” ë°©ì‹ìœ¼ë¡œë„ ì¶”ì²œì‹œìŠ¤í…œì´ ìš´ì˜ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤. 


## Data Augmentation (ë°ì´í„° ì¦ê°•)

>![image](https://github.com/user-attachments/assets/837995e6-207b-42eb-b631-cb66f4feb6a1)
ê·¸ë¦¼ 3. How to do data augmentation



í˜„ì¬ ì„¸ì…˜ ë‚´ì—ì„œ ìœ ì €ì˜ í•„ìš” ìƒí’ˆì„ ì˜ˆì¸¡í•˜ê¸° ìœ„í•´ì„œ ìœ ì €ê°€ ë³´ê³  ìˆëŠ” ìƒí’ˆë“¤ì˜ ì—°ê´€ê´€ê³„ë¥¼ íŒŒì•…í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤. ì´ë¥¼ ìœ„í•´ í•™ìŠµ ë°ì´í„°ì…‹ì— ë°ì´í„° ì¦ê°•ì„ ì§„í–‰í–ˆëŠ”ë°, view ìƒí’ˆ ì´ë ¥ì˜ ì†Œë¹„ ìˆœì„œë¥¼ ë°”ê¾¼ ì‹œí€€ìŠ¤ë¥¼ ì¶”ê°€í–ˆë‹¤. ìƒí’ˆì„ ë³¸ ìˆœì„œ, ì„ í›„ê´€ê³„ê°€ ì¤‘ìš”í•œ ê²ƒì´ ì•„ë‹ˆë¼ ì„¸ì…˜ ë‚´ì˜ ìƒí’ˆë“¤ì´ ì–´ë–»ê²Œ ë¹„ìŠ·í•œ ì§€ë¥¼ ëª¨ë¸ë§ í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤ê³  íŒë‹¨í–ˆê¸° ë•Œë¬¸ì´ë‹¤. ì´ëŠ” BERT4Recê³¼ ê°™ì€ ì–‘ë°©í–¥ í•™ìŠµì„ í†µí•œ ì¶”ì²œ ëª¨ë¸ì˜ ì„±ëŠ¥ì´ ì¼ë°˜ì ìœ¼ë¡œ ë†’ë‹¤ëŠ” ì•„ì´ë””ì–´ë¥¼ ì°¨ìš©í–ˆë‹¤. 



# Session Based Recommendations with LSTM


>![image](https://github.com/user-attachments/assets/c369f020-1d3d-4c0d-bff9-30778e571019)
ê·¸ë¦¼ 4. Session Based Recommender System Flow in this project

ì„¸ì…˜ ë‚´ ì¶”ì²œì‹œìŠ¤í…œì˜ ì „ì²´ íë¦„ë„ëŠ” ìœ„ì™€ ê°™ë‹¤. ì´ ì¤‘ Candidate Generation ê³¼ Top kì— ë”°ë¥¸ ì„±ëŠ¥í‰ê°€ëŠ” Test Setì—ì„œ ìˆ˜í–‰ë˜ë©°, í•™ìŠµ ì‹œì—ëŠ” LSTM ê¸°ë°˜ì˜ ì¶”ì²œëª¨ë¸ì„ ì‚¬ìš©í•œë‹¤. 


## Candidate Generation



## LSTM Structure





## Loss Function

ì²˜ìŒì—ëŠ” ê¸°ë³¸ CrossEntropyLossë¥¼ ì‚¬ìš©í•˜ì—¬ Loss ë¥¼ ì •ì˜í•´ í•™ìŠµì„ ì§„í–‰í–ˆìœ¼ë‚˜, ì—¬ëŸ¬ ì‹œë„ ëì— ìµœì¢…ì ìœ¼ë¡œ `Hard Negative Loss`ì™€ `Weighted Positive Loss`ë¥¼ í•©ì³ ì‚¬ìš©í–ˆë‹¤.

`criterion = nn.CrossEntropyLoss()`

### Hard Negative Loss

```python
weights = torch.where((target == 0) & (outputs > 0.5), 1.0, 0.0)
loss = (weights * criterion(outputs, target)).mean()
```

ì´ë¦„ì—ì„œ ì•Œ ìˆ˜ ìˆë“¯, ì–´ë ¤ìš´ Negative ìƒ˜í”Œì— ë¶€ì—¬í•˜ëŠ” Loss ì´ë‹¤. ì–´ë µë‹¤ëŠ” ê²ƒì€ ì˜ˆì¸¡ì´ ê¹Œë‹¤ë¡œìš´ ìƒ˜í”Œì„ ì˜ë¯¸í•˜ë©°, í•„ìëŠ” **ì‹¤ì œ ê°’ì´ 0ì´ì§€ë§Œ ì˜ˆì¸¡ ê°’ì´ 0.5 ì´ˆê³¼**í•œ ë°ì´í„°ë“¤ì„ ëŒ€ìƒìœ¼ë¡œ ì§„í–‰í–ˆë‹¤. 


### Weighted Positive Loss

```python
weights = torch.where(target == 1, 10.0, 0.0)
weighted_loss = torch.mean(
    (weights * criterion(outputs, target))
)
```

ì‹¤ì œ ê°’ì´ 1ì¸, ì‹¤ì œë¡œ ìœ ì €ê°€ ì„ í˜¸í•œ ìƒí’ˆ(Positive)ì„ ëŒ€ìƒìœ¼ë¡œ Lossì— ê°€ì¤‘ì¹˜ 10ì„ ë¶€ì—¬í•˜ëŠ” ë°©ì‹ì´ë‹¤. ì²˜ìŒì—ëŠ” Negative ì—ë„ ê°€ì¤‘ì¹˜ 1ì„ ë¶€ì—¬í•´ í•™ìŠµí–ˆìœ¼ë‚˜, Negative ëŠ” Hard Negative ìƒ˜í”Œì— ëŒ€í•œ Loss ë§Œ ë¶€ì—¬í•˜ëŠ” ê²ƒì´ ì„±ëŠ¥ì´ ë‚˜ì•˜ë‹¤.



## Evaluation

### Recall@k, Precision@k


